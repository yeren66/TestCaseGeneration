{
    "project_name": "commons-math",
    "file_name": "Neuron.java",
    "relative_path": "commons-math/commons-math-neuralnet/src/main/java/org/apache/commons/math4/neuralnet/Neuron.java",
    "execute_path": "commons-math/commons-math-neuralnet",
    "package": "org.apache.commons.math4.neuralnet",
    "docstring": "/**\n     * Tries to atomically update the neuron's features.\n     * Update will be performed only if the expected values match the\n     * current values.<br>\n     * In effect, when concurrent threads call this method, the state\n     * could be modified by one, so that it does not correspond to the\n     * the state assumed by another.\n     * Typically, a caller {@link #getFeatures() retrieves the current state},\n     * and uses it to compute the new state.\n     * During this computation, another thread might have done the same\n     * thing, and updated the state: If the current thread were to proceed\n     * with its own update, it would overwrite the new state (which might\n     * already have been used by yet other threads).\n     * To prevent this, the method does not perform the update when a\n     * concurrent modification has been detected, and returns {@code false}.\n     * When this happens, the caller should fetch the new current state,\n     * redo its computation, and call this method again.\n     *\n     * @param expect Current values of the features, as assumed by the caller.\n     * Update will never succeed if the contents of this array does not match\n     * the values returned by {@link #getFeatures()}.\n     * @param update Features's new values.\n     * @return {@code true} if the update was successful, {@code false}\n     * otherwise.\n     * @throws IllegalArgumentException if the length of {@code update} is\n     * not the same as specified in the {@link #Neuron(long,double[])\n     * constructor}.\n     */",
    "source_code": "\npublic boolean compareAndSetFeatures(double[] expect,\n                                     double[] update) {\n    if (update.length != size) {\n        throw new NeuralNetException(NeuralNetException.SIZE_MISMATCH,\n                                     update.length, size);\n    }\n\n    // Get the internal reference. Note that this must not be a copy;\n    // otherwise the \"compareAndSet\" below will always fail.\n    final double[] current = features.get();\n    if (!containSameValues(current, expect)) {\n        // Some other thread already modified the state.\n        return false;\n    }\n\n    // Increment attempt counter.\n    numberOfAttemptedUpdates.incrementAndGet();\n\n    if (features.compareAndSet(current, update.clone())) {\n        // The current thread could atomically update the state (attempt succeeded).\n        numberOfSuccessfulUpdates.incrementAndGet();\n        return true;\n    } else {\n        // Some other thread came first (attempt failed).\n        return false;\n    }\n}\n",
    "class_name": "Neuron",
    "method_name": "compareAndSetFeatures",
    "arguments": [
        "double[] expect",
        "double[] update"
    ],
    "generate_test": [
        "@Test\n    public void compareAndSetFeaturesTest() {\n        Neuron neuron = new Neuron(1, new double[]{1.0, 2.0, 3.0});\n        double[] expect = new double[]{1.0, 2.0, 3.0};\n        double[] update = new double[]{4.0, 5.0, 6.0};\n        assertTrue(neuron.compareAndSetFeatures(expect, update));\n        assertFalse(neuron.compareAndSetFeatures(expect, update));\n        assertEquals(2, neuron.getNumberOfAttemptedUpdates());\n        assertEquals(1, neuron.getNumberOfSuccessfulUpdates());\n    }",
        "@Test\npublic void compareAndSetFeaturesTest() {\n    // Create a Neuron instance with initial features\n    double[] initialFeatures = {1.0, 2.0, 3.0};\n    Neuron neuron = new Neuron(1, initialFeatures);\n    \n    // Test case 1: Attempt update with expected values that match current features\n    double[] expect1 = {1.0, 2.0, 3.0};\n    double[] update1 = {4.0, 5.0, 6.0};\n    assertTrue(neuron.compareAndSetFeatures(expect1, update1));\n    assertArrayEquals(update1, neuron.getFeatures());\n    assertEquals(1, neuron.getNumberOfSuccessfulUpdates());\n    \n    // Test case 2: Attempt update with expected values that do not match current features\n    double[] expect2 = {7.0, 8.0, 9.0};\n    double[] update2 = {10.0, 11.0, 12.0};\n    assertFalse(neuron.compareAndSetFeatures(expect2, update2));\n    assertArrayEquals(update1, neuron.getFeatures());  // Features should remain unchanged\n    assertEquals(1, neuron.getNumberOfSuccessfulUpdates());  // Successful updates count should remain unchanged\n    \n    // Test case 3: Attempt update with invalid update size\n    double[] expect3 = {4.0, 5.0, 6.0};\n    double[] update3 = {13.0, 14.0};  // Invalid size\n    assertThrows(NeuralNetException.class, () -> neuron.compareAndSetFeatures(expect3, update3));\n    assertArrayEquals(update1, neuron.getFeatures());  // Features should remain unchanged\n    assertEquals(1, neuron.getNumberOfSuccessfulUpdates());  // Successful updates count should remain unchanged\n}",
        "@Test\npublic void compareAndSetFeaturesTest() {\n    double[] expect = {1.0, 2.0, 3.0};\n    double[] update = {4.0, 5.0, 6.0};\n    \n    Neuron neuron = new Neuron(1, expect);\n    boolean result = neuron.compareAndSetFeatures(expect, update);\n    \n    assertTrue(result);\n}",
        "@Test\npublic void compareAndSetFeaturesTest() {\n    Neuron neuron = new Neuron(1, new double[]{1.0, 2.0, 3.0});\n    double[] expect = {1.0, 2.0, 3.0};\n    double[] update = {4.0, 5.0, 6.0};\n    \n    assertTrue(neuron.compareAndSetFeatures(expect, update));\n    assertArrayEquals(update, neuron.getFeatures());\n    \n    assertFalse(neuron.compareAndSetFeatures(expect, update));\n}",
        "@Test\npublic void compareAndSetFeaturesTest() {\n    Neuron neuron = new Neuron(1, new double[]{1.0, 2.0, 3.0});\n    double[] currentFeatures = neuron.getFeatures();\n    double[] expect = new double[]{1.0, 2.0, 3.0};\n    double[] update = new double[]{4.0, 5.0, 6.0};\n    \n    // Test when expect values match current features\n    boolean result = neuron.compareAndSetFeatures(expect, update);\n    assertTrue(result);\n    assertArrayEquals(update, neuron.getFeatures());\n    \n    // Test when expect values do not match current features\n    double[] newExpect = new double[]{2.0, 3.0, 4.0};\n    result = neuron.compareAndSetFeatures(newExpect, update);\n    assertFalse(result);\n    assertArrayEquals(update, neuron.getFeatures());\n    \n    // Test when update length is different from neuron size\n    double[] invalidUpdate = new double[]{4.0};\n    assertThrows(NeuralNetException.class, () -> neuron.compareAndSetFeatures(expect, invalidUpdate));\n}",
        "\npackage org.apache.commons.math4.neuralnet;\n\nimport org.junit.jupiter.api.*;\nimport static org.junit.jupiter.api.Assertions.*;\n\npublic class NeuronTest {\n    @Test\n    public void compareAndSetFeaturesTest() {\n        double[] currentFeatures = {1.0, 2.0, 3.0};\n        double[] expectedFeatures = {1.0, 2.0, 3.0};\n        double[] newFeatures = {4.0, 5.0, 6.0};\n\n        Neuron neuron = new Neuron(1, currentFeatures);\n        boolean success = neuron.compareAndSetFeatures(expectedFeatures, newFeatures);\n\n        assertTrue(success);\n        assertArrayEquals(newFeatures, neuron.getFeatures());\n    }\n}\n",
        "@Test\npublic void compareAndSetFeaturesTest() {\n    Neuron neuron = new Neuron(1, new double[] {1.0, 2.0, 3.0});\n\n    double[] expect = new double[] {1.0, 2.0, 3.0};\n    double[] update = new double[] {4.0, 5.0, 6.0};\n\n    assertTrue(neuron.compareAndSetFeatures(expect, update));\n    assertFalse(neuron.compareAndSetFeatures(expect, update));\n}",
        "    public void compareAndSetFeaturesTest() {\n        // Create a neuron with initial features\n        double[] initialFeatures = {1.0, 2.0, 3.0};\n        Neuron neuron = new Neuron(1, initialFeatures);\n\n        // Define the expected and updated features\n        double[] expectedFeatures = {1.0, 2.0, 3.0};\n        double[] updatedFeatures = {4.0, 5.0, 6.0};\n\n        // Perform the compareAndSetFeatures operation\n        boolean result = neuron.compareAndSetFeatures(expectedFeatures, updatedFeatures);\n\n        // Check the result and assert the expected values\n        assertTrue(result);  // Expecting the update to be successful\n        assertArrayEquals(updatedFeatures, neuron.getFeatures());  // Expecting the features to be updated\n    }",
        "@Test\npublic void compareAndSetFeaturesTest() {\n    Neuron neuron = new Neuron(1, new double[]{1.0, 2.0, 3.0});\n\n    // Test case 1: Update with same values\n    double[] expect1 = {1.0, 2.0, 3.0};\n    double[] update1 = {1.0, 2.0, 3.0};\n    assertTrue(neuron.compareAndSetFeatures(expect1, update1));\n\n    // Test case 2: Update with different values\n    double[] expect2 = {1.0, 2.0, 3.0};\n    double[] update2 = {4.0, 5.0, 6.0};\n    assertFalse(neuron.compareAndSetFeatures(expect2, update2));\n\n    // Test case 3: Update with different lengths\n    double[] expect3 = {1.0, 2.0, 3.0};\n    double[] update3 = {1.0, 2.0};\n    assertThrows(NeuralNetException.class, () ->\n            neuron.compareAndSetFeatures(expect3, update3));\n}",
        "@Test\npublic void compareAndSetFeaturesTest() {\n    Neuron neuron = new Neuron(1, new double[]{1.0, 2.0, 3.0});\n    double[] expect = new double[]{1.0, 2.0, 3.0};\n    double[] update = new double[]{4.0, 5.0, 6.0};\n    \n    assertTrue(neuron.compareAndSetFeatures(expect, update));\n}"
    ]
}