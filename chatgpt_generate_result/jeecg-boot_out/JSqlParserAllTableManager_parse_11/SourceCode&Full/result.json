{
    "project_name": "jeecg-boot",
    "file_name": "JSqlParserAllTableManager.java",
    "relative_path": "jeecg-boot/jeecg-boot-base-core/src/main/java/org/jeecg/common/util/sqlparse/JSqlParserAllTableManager.java",
    "execute_path": "jeecg-boot",
    "package": "org.jeecg.common.util.sqlparse",
    "docstring": "/**\n     * \u5f00\u59cb\u89e3\u6790\n     *\n     * @return\n     * @throws JSQLParserException\n     */",
    "source_code": "\npublic Map<String, SelectSqlInfo> parse() throws JSQLParserException {\n    // 1. \u521b\u5efa\u89e3\u6790\u5668\n    CCJSqlParserManager mgr = new CCJSqlParserManager();\n    // 2. \u4f7f\u7528\u89e3\u6790\u5668\u89e3\u6790sql\u751f\u6210\u5177\u6709\u5c42\u6b21\u7ed3\u6784\u7684java\u7c7b\n    Statement stmt = mgr.parse(new StringReader(this.sql));\n    if (stmt instanceof Select) {\n        Select selectStatement = (Select) stmt;\n        SelectBody selectBody = selectStatement.getSelectBody();\n        this.parsedSql = selectBody.toString();\n        // 3. \u89e3\u6790select\u67e5\u8be2sql\u7684\u4fe1\u606f\n        if (selectBody instanceof PlainSelect) {\n            PlainSelect plainSelect = (PlainSelect) selectBody;\n            // 4. \u5408\u5e76 fromItems\n            List<FromItem> fromItems = new ArrayList<>();\n            fromItems.add(plainSelect.getFromItem());\n            // 4.1 \u5904\u7406join\u7684\u8868\n            List<Join> joins = plainSelect.getJoins();\n            if (joins != null) {\n                joins.forEach(join -> fromItems.add(join.getRightItem()));\n            }\n            // 5. \u5904\u7406 fromItems\n            for (FromItem fromItem : fromItems) {\n                // 5.1 \u901a\u8fc7\u8868\u540d\u7684\u65b9\u5f0ffrom\n                if (fromItem instanceof Table) {\n                    this.addSqlInfoByTable((Table) fromItem);\n                }\n                // 5.2 \u901a\u8fc7\u5b50\u67e5\u8be2\u7684\u65b9\u5f0ffrom\n                else if (fromItem instanceof SubSelect) {\n                    this.handleSubSelect((SubSelect) fromItem);\n                }\n            }\n            // 6. \u89e3\u6790 selectFields\n            List<SelectItem> selectItems = plainSelect.getSelectItems();\n            for (SelectItem selectItem : selectItems) {\n                // 6.1 \u67e5\u8be2\u7684\u662f\u5168\u90e8\u5b57\u6bb5\n                if (selectItem instanceof AllColumns) {\n                    // \u5f53 selectItem \u4e3a AllColumns \u65f6\uff0cfromItem \u5fc5\u5b9a\u4e3a Table\n                    String tableName = plainSelect.getFromItem(Table.class).getName();\n                    // \u6b64\u5904\u5fc5\u5b9a\u4e0d\u4e3a\u7a7a\uff0c\u56e0\u4e3a\u5728\u89e3\u6790 fromItem \u65f6\uff0c\u5df2\u7ecf\u5c06\u8868\u540d\u6dfb\u52a0\u5230 allTableMap \u4e2d\n                    SelectSqlInfo sqlInfo = this.allTableMap.get(tableName);\n                    assert sqlInfo != null;\n                    // \u8bbe\u7f6e\u4e3a\u67e5\u8be2\u5168\u90e8\u5b57\u6bb5\n                    sqlInfo.setSelectAll(true);\n                    sqlInfo.setSelectFields(null);\n                    sqlInfo.setRealSelectFields(null);\n                }\n                // 6.2 \u67e5\u8be2\u7684\u662f\u5e26\u8868\u522b\u540d\uff08 u.* )\u7684\u5168\u90e8\u5b57\u6bb5\n                else if (selectItem instanceof AllTableColumns) {\n                    AllTableColumns allTableColumns = (AllTableColumns) selectItem;\n                    String aliasName = allTableColumns.getTable().getName();\n                    // \u901a\u8fc7\u522b\u540d\u83b7\u53d6\u8868\u540d\n                    String tableName = this.tableAliasMap.get(aliasName);\n                    if (tableName == null) {\n                        tableName = aliasName;\n                    }\n                    SelectSqlInfo sqlInfo = this.allTableMap.get(tableName);\n                    // \u5982\u679c\u6b64\u5904\u4e3a\u7a7a\uff0c\u5219\u8bf4\u660e\u8be5\u5b57\u6bb5\u662f\u901a\u8fc7\u5b50\u67e5\u8be2\u83b7\u53d6\u7684\uff0c\u6240\u4ee5\u53ef\u4ee5\u4e0d\u5904\u7406\uff0c\u53ea\u6709\u5b9e\u9645\u8868\u624d\u9700\u8981\u5904\u7406\n                    if (sqlInfo != null) {\n                        // \u8bbe\u7f6e\u4e3a\u67e5\u8be2\u5168\u90e8\u5b57\u6bb5\n                        sqlInfo.setSelectAll(true);\n                        sqlInfo.setSelectFields(null);\n                        sqlInfo.setRealSelectFields(null);\n                    }\n                }\n                // 6.3 \u5404\u79cd\u5b57\u6bb5\u8868\u8fbe\u5f0f\u5904\u7406\n                else if (selectItem instanceof SelectExpressionItem) {\n                    SelectExpressionItem selectExpressionItem = (SelectExpressionItem) selectItem;\n                    Expression expression = selectExpressionItem.getExpression();\n                    Alias alias = selectExpressionItem.getAlias();\n                    this.handleExpression(expression, alias, plainSelect.getFromItem());\n                }\n            }\n        } else {\n            log.warn(\"\u6682\u65f6\u5c1a\u672a\u5904\u7406\u8be5\u7c7b\u578b\u7684 SelectBody: {}\", selectBody.getClass().getName());\n            throw new JeecgBootException(\"\u6682\u65f6\u5c1a\u672a\u5904\u7406\u8be5\u7c7b\u578b\u7684 SelectBody\");\n        }\n    } else {\n        // \u975e select \u67e5\u8be2sql\uff0c\u4e0d\u505a\u5904\u7406\n        throw new JeecgBootException(\"\u975e select \u67e5\u8be2sql\uff0c\u4e0d\u505a\u5904\u7406\");\n    }\n    return this.allTableMap;\n}\n",
    "class_name": "JSqlParserAllTableManager",
    "method_name": "parse",
    "arguments": [],
    "generate_test": [
        "@Test\npublic void parseTest() {\n    String selectSql = \"SELECT * FROM users\";\n    JSqlParserAllTableManager parser = new JSqlParserAllTableManager(selectSql);\n    try {\n        parser.parse();\n        // Assert the expected values\n        // For example:\n        Map<String, SelectSqlInfo> result = parser.getAllTableMap();\n        assertNotNull(result);\n        assertEquals(1, result.size());\n        assertTrue(result.containsKey(\"users\"));\n        SelectSqlInfo sqlInfo = result.get(\"users\");\n        assertTrue(sqlInfo.isSelectAll());\n        assertNull(sqlInfo.getSelectFields());\n        assertNull(sqlInfo.getRealSelectFields());\n    } catch (JSQLParserException e) {\n        e.printStackTrace();\n    }\n}",
        "@Test\npublic void parseTest() throws JSQLParserException {\n    String selectSql = \"SELECT t1.column1, t2.column2 FROM table1 t1 JOIN table2 t2 ON t1.id = t2.id\";\n    JSqlParserAllTableManager manager = new JSqlParserAllTableManager(selectSql);\n    Map<String, SelectSqlInfo> result = manager.parse();\n\n    assertNotNull(result);\n    assertEquals(2, result.size());\n    assertTrue(result.containsKey(\"table1\"));\n    assertTrue(result.containsKey(\"table2\"));\n\n    SelectSqlInfo table1Info = result.get(\"table1\");\n    assertEquals(\"SELECT t1.column1, t2.column2 FROM table1 t1 JOIN table2 t2 ON t1.id = t2.id\", table1Info.getSelectSql());\n    assertFalse(table1Info.isSelectAll());\n    assertEquals(2, table1Info.getSelectFields().size());\n    assertEquals(2, table1Info.getRealSelectFields().size());\n\n    SelectSqlInfo table2Info = result.get(\"table2\");\n    assertEquals(\"SELECT t1.column1, t2.column2 FROM table1 t1 JOIN table2 t2 ON t1.id = t2.id\", table2Info.getSelectSql());\n    assertFalse(table2Info.isSelectAll());\n    assertEquals(2, table2Info.getSelectFields().size());\n    assertEquals(2, table2Info.getRealSelectFields().size());\n}",
        "@Test\npublic void parseTest() {\n    String sql = \"SELECT * FROM users\";\n    JSqlParserAllTableManager manager = new JSqlParserAllTableManager(sql);\n    try {\n        manager.parse();\n        Map<String, SelectSqlInfo> allTableMap = manager.getAllTableMap();\n        assertNotNull(allTableMap);\n        assertEquals(1, allTableMap.size());\n        assertTrue(allTableMap.containsKey(\"users\"));\n        SelectSqlInfo sqlInfo = allTableMap.get(\"users\");\n        assertTrue(sqlInfo.isSelectAll());\n        assertNull(sqlInfo.getSelectFields());\n        assertNull(sqlInfo.getRealSelectFields());\n    } catch (JSQLParserException e) {\n        fail(\"Failed to parse the SQL statement\");\n    }\n}",
        "@Test\npublic void parseTest() {\n    String selectSql = \"SELECT * FROM table1\";\n    JSqlParserAllTableManager manager = new JSqlParserAllTableManager(selectSql);\n    try {\n        manager.parse();\n        // Add assertions here to verify the expected output\n    } catch (JSQLParserException e) {\n        fail(\"Parsing failed: \" + e.getMessage());\n    }\n}",
        "@Test\npublic void parseTest() {\n    String selectSql = \"SELECT a.id, b.name FROM table_a a JOIN table_b b ON a.id = b.id\";\n    JSqlParserAllTableManager manager = new JSqlParserAllTableManager(selectSql);\n    try {\n        manager.parse();\n        Map<String, SelectSqlInfo> result = manager.getAllTableMap();\n        assertEquals(2, result.size());\n        assertNotNull(result.get(\"table_a\"));\n        assertNotNull(result.get(\"table_b\"));\n        SelectSqlInfo tableAInfo = result.get(\"table_a\");\n        SelectSqlInfo tableBInfo = result.get(\"table_b\");\n        assertTrue(tableAInfo.isSelectAll());\n        assertNull(tableAInfo.getSelectFields());\n        assertNull(tableAInfo.getRealSelectFields());\n        assertTrue(tableBInfo.isSelectAll());\n        assertNull(tableBInfo.getSelectFields());\n        assertNull(tableBInfo.getRealSelectFields());\n    } catch (Exception e) {\n        fail(\"An exception occurred: \" + e.getMessage());\n    }\n}",
        "@Test\npublic void parseTest() {\n    String selectSql = \"SELECT * FROM table1\";\n    JSqlParserAllTableManager manager = new JSqlParserAllTableManager(selectSql);\n    try {\n        Map<String, SelectSqlInfo> result = manager.parse();\n        assertNotNull(result);\n        assertEquals(1, result.size());\n        assertTrue(result.containsKey(\"table1\"));\n        SelectSqlInfo sqlInfo = result.get(\"table1\");\n        assertTrue(sqlInfo.isSelectAll());\n        assertNull(sqlInfo.getSelectFields());\n        assertNull(sqlInfo.getRealSelectFields());\n    } catch (JSQLParserException e) {\n        fail(\"Exception occurred: \" + e.getMessage());\n    }\n}",
        "JSqlParserAllTableManager manager = new JSqlParserAllTableManager(\"SELECT * FROM table_name\");\nMap<String, SelectSqlInfo> result = manager.parse();\nassertEquals(1, result.size());\nSelectSqlInfo sqlInfo = result.get(\"table_name\");\nassertTrue(sqlInfo.isSelectAll());\nassertNull(sqlInfo.getSelectFields());\nassertNull(sqlInfo.getRealSelectFields());",
        "@Test\npublic void parseTest() {\n    JSqlParserAllTableManager manager = new JSqlParserAllTableManager(\"SELECT * FROM table\");\n    try {\n        Map<String, SelectSqlInfo> result = manager.parse();\n        assertNotNull(result);\n        assertEquals(1, result.size());\n        // Add more assertions for the expected values\n    } catch (JSQLParserException e) {\n        fail(\"Exception thrown: \" + e.getMessage());\n    }\n}",
        "@Test\npublic void parseTest() {\n    String sql = \"SELECT * FROM table1 t1 INNER JOIN table2 t2 ON t1.id = t2.id\";\n    JSqlParserAllTableManager manager = new JSqlParserAllTableManager(sql);\n    try {\n        Map<String, SelectSqlInfo> result = manager.parse();\n        assertEquals(2, result.size());\n        assertTrue(result.containsKey(\"table1\"));\n        assertTrue(result.containsKey(\"table2\"));\n    } catch (JSQLParserException e) {\n        fail(\"An exception was thrown: \" + e.getMessage());\n    }\n}",
        "package org.jeecg.common.util.sqlparse;\n\nimport org.junit.jupiter.api.*;\nimport static org.junit.jupiter.api.Assertions.*;\n\npublic class JSqlParserAllTableManagerTest {\n    @Test\n    public void parseTest() {\n        String selectSql = \"SELECT a.id, b.name FROM table_a a JOIN table_b b ON a.id = b.id\";\n        \n        JSqlParserAllTableManager manager = new JSqlParserAllTableManager(selectSql);\n        try {\n            manager.parse();\n            // Add assertions here\n        } catch (Exception e) {\n            fail(\"Exception occurred: \" + e.getMessage());\n        }\n    }\n}"
    ]
}